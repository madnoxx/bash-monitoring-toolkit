# Bash Monitoring Toolkit

Набор утилит на Bash для базового DevOps-мониторинга и обслуживания серверов/проектов.

Проект помогает автоматизировать рутинные задачи:
- просмотр состояния системы (CPU, память, диск, сетевые соединения);
- проверка доступности URL;
- проверка корректности `docker-compose.yml`;
- создание резервных копий директории проекта;
- запуск всех утилит одним скриптом;
- добавление регулярного запуска в `cron`.

## Состав проекта

### `config.sh`
Общий конфигурационный файл:
- задаёт ANSI-цвета для красивого вывода;
- создаёт директорию `./logs`;
- определяет пути к логам:
  - `logs/monitor.log`
  - `logs/healthcheck.log`
  - `logs/docker_check.log`
  - `logs/backup.log`
- содержит общую функцию `log()`, которая пишет сообщения в указанный лог с timestamp.

> Этот файл подключается (`source ./config.sh`) в рабочих скриптах.

---

### `monitor.sh`
Скрипт системного мониторинга.

Что делает:
1. Выводит текущую дату и hostname.
2. Показывает load average (`uptime`).
3. Показывает использование памяти (`free -h`).
4. Показывает использование корневого диска (`df -h /`).
5. Считает число сетевых соединений (`ss -tunap | wc -l`).
6. Записывает этапы работы в `logs/monitor.log`.

---

### `healthcheck.sh`
Проверка доступности URL.

Что делает:
1. Запрашивает у пользователя URL.
2. Выполняет `curl` и получает HTTP status code.
3. Если код `200` — считает ресурс доступным, иначе пишет ошибку.
4. Результат пишет в `logs/healthcheck.log`.
5. После выполнения оставляет в логе только последние 20 строк.

---

### `docker_check.sh`
Валидация файла `docker-compose.yml`.

Что делает:
1. Проверяет наличие `docker-compose` или `docker compose`.
2. Проверяет, что в текущей директории есть `docker-compose.yml`.
3. Запускает проверку синтаксиса командой `docker compose config -q` (или `docker-compose config -q`).
4. Результат записывает в `logs/docker_check.log`.

---

### `backup.sh`
Создание резервной копии директории проекта.

Что делает:
1. Запрашивает путь к директории.
2. Проверяет, что директория существует.
3. Создаёт архив `backup_<project_name>_<timestamp>.tar.gz`.
4. Сохраняет архив в `/tmp/backups`.
5. Удаляет архивы старше 7 дней.
6. Пишет результат в `logs/backup.log`.

---

### `run.sh`
Оркестратор запуска всех утилит.

Что делает:
1. По очереди запускает:
   - `monitor.sh`
   - `healthcheck.sh`
   - `docker_check.sh`
   - `backup.sh`
2. Проверяет, что каждый файл существует и исполняемый.
3. Логирует общий старт/финиш в `logs/monitor.log`.

> Важно: `healthcheck.sh` и `backup.sh` интерактивные (запрашивают ввод), поэтому при запуске `run.sh` нужно быть готовым отвечать на вопросы в терминале.

---

### `cron-setup.sh`
Автоматическое добавление задач в `crontab` пользователя.

Добавляемые расписания:
- `monitor.sh` — каждые 30 минут (`*/30 * * * *`)
- `healthcheck.sh` — каждые 10 минут (`*/10 * * * *`)
- `backup.sh` — ежедневно в 02:00 (`0 2 * * *`)
- `docker_check.sh` — ежедневно в 03:00 (`0 3 * * *`)

Скрипт не дублирует уже существующие записи и использует абсолютный путь к файлам.

## Требования

Минимально:
- Bash 4+
- `curl`
- `tar`, `find`, `df`, `free`, `ss`, `awk`
- `cron`/`crontab`

Дополнительно для проверки Compose:
- `docker compose` **или** `docker-compose`

## Порядок запуска

### 1. Клонирование/подготовка
```bash
git clone <repo-url>
cd bash-monitoring-toolkit
```

### 2. Выдать права на исполнение
```bash
chmod +x *.sh
```

### 3. Запуск по отдельности (ручная проверка)
```bash
./monitor.sh
./healthcheck.sh
./docker_check.sh
./backup.sh
```

### 4. Запуск всего набора
```bash
./run.sh
```

### 5. Настроить периодический запуск через cron
```bash
./cron-setup.sh
crontab -l
```

## Порядок проверки работы

### Проверка логов
```bash
ls -lh logs/
tail -n 50 logs/monitor.log
tail -n 50 logs/healthcheck.log
tail -n 50 logs/docker_check.log
tail -n 50 logs/backup.log
```

### Проверка backup-файлов
```bash
ls -lh /tmp/backups
```

### Проверка cron-задач
```bash
crontab -l
```
